---
title: "L2間でのトークンを移動できるようにするhopの仕組み"
emoji: "🔖"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["ethereum", "rollup", "hop.exchange"]
published: false
---
## 現状の課題
今だと、Layer2のチェーン間でのやりとりをしようと思うと、一度L1に引き出してから、再度L2にデポジットすることになると思います。
そうなると、L1でのガス代も無駄ですし、Optimistic RollupではFraud Proofという不正検証の仕組みがあるので、L1へ引き出す際に1週間ほどかかってしまいます。

そこで考え出されたのが、L2同士でトークンのやりとりができるhopという仕組みです。

## hop protocolとは？
ロールアップ間つまりL2間でのトークンの送信をするプロジェクトです。

### hop bridge tokenとは？
ホップブリッジトークン(ex: Hop　ETH hETH, Hop Dai hDAI )と呼ばれる(以下、hToken)、L2間で一括転送可能な特殊なトークンです。

各hTokenは、L1のホップブリッジコントラクトへのデポジットを表しています。例えば、4ETHがL1でデポジットされると、L2で4hETHが発行されるという感じです。

逆に、L2上で発行されているhTokenをバーンすることによって、hTokenはL1上で元のトークンに交換できます。

hTokenがL2間で転送される時に、送る側のL2でhTokenがバーンされて、送られた方のL2でhTokenが発行されます。

これらの即時転送は、”ボンダー”が少額の手数料と引き換えに、送り先での流動性を提供することを許可することによって、達成できます。
![](https://storage.googleapis.com/zenn-user-upload/zsfleodecjj4sev4xts8re1vtfty)
>Figure 1: Alice deposits 4 ETH into the L1 Bridge contract and receives 4 Hop
ETH from the L2 Bridge contract. - https://hop.exchange/whitepaper.pdf


### トークンを転送する
トークンの転送には以下のような情報が必要です。
- 目的地のchain Id
- 受信者のアドレス
- 転送する量

### Transfer Root
マークルツリーを利用して、最小限のデータで、転送を表現します。

- 転送のマークルルート
- チェーンIDで表されるユニークなアドレスの配列
- それぞれのユニークなアドレスに転送される合計金額の配列


![](https://storage.googleapis.com/zenn-user-upload/zibjb4zge7bt4f71pn2jq5w8ak1x)
>Figure 2: The four pending Transfers are aggregated into a Transfer Root with
three destinations. - https://hop.exchange/whitepaper.pdf

1つのTransfer Rootには何千もの転送が含まれていますが、1つの塊としてL1上で処理することができます。
これにより、L1のボトルネックが緩和sれ、多くの転送をL1を経由して、スケーラブルな方法で方法で転送先のL2に渡すことができます。

しかし、Transfer Rootの伝搬には時間がかかります。これは主に、Transfer Rootの起点となったロールアップのexit timeに起因します。

転送をすぐに実行するためには、次のセクションで説明するサードパーティが目的地のL2上で少額の手数料を払って、前払い流動性を提供することできます。

### Transfer Bonds(債権譲渡)
`bonder` は実行することにより、転送が元のL2で行われたことを確認できます。
`bonder`はL2の検証ノードを実行することで、転送が転送元のL2で行われたことを確認できます。

`bonder`はすぐに転送を実行するために、転送先のL2で前払い流動性を提供することができます。最終的に転送が目的地に到達すると、`bonder`の資金が復元されます。

`bonder`は、送金が伝搬している間、流動性をロックする代わりに、少額の手数炉湯を得ることができます。


### AMM
各hTokenはL1トークンを表し、迅速かつ経済的にL2間を移動することができます。

通常のネットワーク条件では、各hTokenはいつでもL1で元のトークンに変換できるため、各hTokenはL1とL2で1-1で交換できる価値を持つ。




![](https://storage.googleapis.com/zenn-user-upload/k2zqw0od23ed8vgnhcn822sioqzi)
>https://github.com/hop-exchange/contracts/blob/master/assets/Hop_Transfer_Diagrams.jpg


## hopが成立するための前提
- L2上で動いているAMM(Uniswap)でhTokenの価格がある程度安定する必要がある

## 個人的な見解
hopが目指すことはシンプルなのですが、ソリューションが色々とこねくり回して出てきたものって感じが否めなく、複雑な仕組みは維持するための複数の前提の元に成り立っているなという感じがしました。



## ツッコミとか
>本当にそのトークンいる？ロールアップ内でトークンを直接操作したらよくね？
